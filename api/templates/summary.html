<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chartkick@5.0.1/dist/chartkick.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highcharts"></script>
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet">
    </style>

</head>

<body>
    <div class="container py-5">
        <!-- Header -->
        <div class="mb-4">
            <div class="card">
                <div class="card-body">
                    <h4 class="page-title">{{task.file_name}}</h4>
                    <div class="d-flex flex-wrap">
                        <span class="badge bg-primary me-2">
                            Static Analysis: {{ 'Enabled' if task.enable_static_analysis else 'Disabled' }}
                        </span>
                        <span class="badge bg-secondary me-2">
                            Dynamic Analysis: {{ 'Enabled' if task.enable_dynamic_analysis else 'Disabled' }}
                        </span>
                        <span class="badge 
                        {% if task.task_status == 'COMPLETED' %}bg-success
                        {% elif task.task_status == 'IN_PROGRESS' %}bg-warning
                        {% elif task.task_status == 'PENDING' %}bg-info
                        {% elif task.task_status == 'FAILED' %}bg-danger
                        {% else %}bg-secondary
                        {% endif %} me-2"> Status: {{ task.task_status | capitalize }}
                        </span>

                        {% if payload.internal_name %}
                        <span class="badge bg-info me-2">
                            Internal Name: {{ payload.internal_name }}
                        </span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>


        <!-- Analysis Results -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body p-3">
                        <h5 class="card-title">AMSI Result</h5>
                        <span class="badge 
                    {% if task.amsi_result == 'AMSI_RESULT_NOT_DETECTED' %}bg-success
                    {% else %}bg-danger
                    {% endif %}">
                            {{ task.amsi_result }}
                        </span>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body p-3">
                        <h5 class="card-title">Defender Result</h5>
                        <span class="badge 
                    {% if task.defender_result == 'DEFENDER_RESULT_NOT_DETECTED' %}bg-success
                    {% else %}bg-danger
                    {% endif %}">
                            {{ task.defender_result }}
                        </span>
                    </div>
                </div>
            </div>

        </div>

        {% if task.threat_names %}
        <!-- Task Overview -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card h-100">
                    <div class="card-body p-3">
                        <h5 class="card-title">Threats</h5>
                        <p class="mb-0">
                            {{ task.threat_names | join(", ") }}
                        </p>
                    </div>
                </div>
            </div>

        </div>
        {% endif %}

        {% if task.yara_matches %}
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card h-100">
                    <div class="card-body p-3">
                        <h5 class="card-title">Yara Rules</h5>
                        <table class="table" id="yaraTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Description</th>
                                    <th>Author</th>
                                    <th>Reference</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for yara in task.yara_matches %}
                                <tr>
                                    <td>{{ yara.name }}</td>
                                    <td>{{ yara.description }}</td>
                                    <td>{{ yara.author }}</td>
                                    <td><a href="{{ yara.reference }}" target="_blank">{{ yara.reference }}</a></td>
                                    <td>{{ yara.date }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body p-3">
                        <h5 class="card-title">Function Mapping</h5>
                        {{function_mapping_chart}}
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body p-3">
                        <h5 class="card-title">Entropy</h5>
                        {{entropy_chart}}
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card h-100">
                    <div class="card-body p-3">
                        <h5 class="card-title">Imports</h5>
                        {{imports_chart}}
                    </div>
                </div>
            </div>
        </div>

        {% if payload %}
        {% if payload.sections %}
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card h-100">
                    <div class="card-body p-3">
                        <h5 class="card-title">PE</h5>
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" data-bs-toggle="tab" href="#pemetadata"
                                    role="tab">Metadata</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#optionalheaders" role="tab">Optional
                                    Headers</a>
                            </li>
                            {% if payload.imports %}
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#peimports" role="tab">Imports</a>
                            </li>
                            {% endif %}
                            {% if payload.exports %}
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#peexports" role="tab">Exports</a>
                            </li>
                            {% endif %}
                            {% if payload.sections %}
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#sections" role="tab">Sections</a>
                            </li>
                            {% endif %}
                            {% if payload.compilers %}
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#compilers" role="tab">Compilers</a>
                            </li>
                            {% endif %}
                            {% if payload.libraries %}
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#libraries" role="tab">Libraries</a>
                            </li>
                            {% endif %}
                            {% if payload.linkers %}
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#linkers" role="tab">Linkers</a>
                            </li>
                            {% endif %}
                            {% if payload.packers %}
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#packers" role="tab">Packers</a>
                            </li>
                            {% endif %}
                            {% if payload.sign_tools %}
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#sign_tools" role="tab">Sign Tools</a>
                            </li>
                            {% endif %}
                            {% if payload.tools %}
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#tools" role="tab">Tools</a>
                            </li>
                            {% endif %}
                        </ul>
                        <div class="tab-content mt-3">
                            <div class="tab-pane fade show active" id="pemetadata" role="tabpanel">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Attribute</th>
                                            <th>Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>File Name</td>
                                            <td>{{ payload.file_name }}</td>
                                        </tr>
                                        <tr>
                                            <td>File Size</td>
                                            <td>{{ payload.file_size }}</td>
                                        </tr>
                                        <tr>
                                            <td>File Type</td>
                                            <td>{{ payload.file_type }}</td>
                                        </tr>
                                        <tr>
                                            <td>Timestamp</td>
                                            <td>{{ payload.timestamp }}</td>
                                        </tr>
                                        <tr>
                                            <td>Entropy</td>
                                            <td>{{ payload.entropy }}</td>
                                        </tr>
                                        <tr>
                                            <td>SHA256</td>
                                            <td>{{ payload.sha256 }}</td>
                                        </tr>
                                        <tr>
                                            <td>TLSH</td>
                                            <td>{{ payload.tlsh }}</td>
                                        </tr>
                                        <tr>
                                            <td>Architecture</td>
                                            <td>{{ payload.architecture }}</td>
                                        </tr>
                                        <tr>
                                            <td>Signed</td>
                                            <td>{{ payload.signed }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="tab-pane fade" id="optionalheaders" role="tabpanel">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Attribute</th>
                                            <th>Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>AddressOfEntryPoint</td>
                                            <td>{{ payload.optional_headers.addressofentrypoint }}</td>
                                        </tr>
                                        <tr>
                                            <td>BaseOfCode</td>
                                            <td>{{ payload.optional_headers.baseofcode }}</td>
                                        </tr>
                                        <tr>
                                            <td>CheckSum</td>
                                            <td>{{ payload.optional_headers.checksum }}</td>
                                        </tr>
                                        <tr>
                                            <td>DllCharacteristics</td>
                                            <td>{{ payload.optional_headers.dllcharacteristics }}</td>
                                        </tr>
                                        <tr>
                                            <td>FileAlignment</td>
                                            <td>{{ payload.optional_headers.filealignment }}</td>
                                        </tr>
                                        <tr>
                                            <td>IMAGE_DLLCHARACTERISTICS_APPCONTAINER</td>
                                            <td>{{ payload.optional_headers.imagedllcharacteristicsappcontainer }}</td>
                                        </tr>
                                        <tr>
                                            <td>IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE</td>
                                            <td>{{ payload.optional_headers.imagedllcharacteristicsdynamicbase }}</td>
                                        </tr>
                                        <tr>
                                            <td>IMAGE_DLLCHARACTERISTICS_FORCE_INTEGRITY</td>
                                            <td>{{ payload.optional_headers.imagedllcharacteristicsforceintegrity }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>IMAGE_DLLCHARACTERISTICS_GUARD_CF</td>
                                            <td>{{ payload.optional_headers.imagedllcharacteristicsguardcf }}</td>
                                        </tr>
                                        <tr>
                                            <td>IMAGE_DLLCHARACTERISTICS_HIGH_ENTROPY_VA</td>
                                            <td>{{ payload.optional_headers.imagedllcharacteristicshighentropyva }}</td>
                                        </tr>
                                        <tr>
                                            <td>IMAGE_DLLCHARACTERISTICS_NO_BIND</td>
                                            <td>{{ payload.optional_headers.imagedllcharacteristicsnobind }}</td>
                                        </tr>
                                        <tr>
                                            <td>IMAGE_DLLCHARACTERISTICS_NO_ISOLATION</td>
                                            <td>{{ payload.optional_headers.imagedllcharacteristicsnoisolation }}</td>
                                        </tr>
                                        <tr>
                                            <td>IMAGE_DLLCHARACTERISTICS_NO_SEH</td>
                                            <td>{{ payload.optional_headers.imagedllcharacteristicsnoseh }}</td>
                                        </tr>
                                        <tr>
                                            <td>IMAGE_DLLCHARACTERISTICS_NX_COMPAT</td>
                                            <td>{{ payload.optional_headers.imagedllcharacteristicsnxcompat }}</td>
                                        </tr>
                                        <tr>
                                            <td>IMAGE_DLLCHARACTERISTICS_TERMINAL_SERVER_AWARE</td>
                                            <td>{{ payload.optional_headers.imagedllcharacteristicsterminalserveraware
                                                }}</td>
                                        </tr>
                                        <tr>
                                            <td>IMAGE_DLLCHARACTERISTICS_WDM_DRIVER</td>
                                            <td>{{ payload.optional_headers.imagedllcharacteristicswdmdriver }}</td>
                                        </tr>
                                        <tr>
                                            <td>ImageBase</td>
                                            <td>{{ payload.optional_headers.imagebase }}</td>
                                        </tr>
                                        <tr>
                                            <td>LoaderFlags</td>
                                            <td>{{ payload.optional_headers.loaderflags }}</td>
                                        </tr>
                                        <tr>
                                            <td>Magic</td>
                                            <td>{{ payload.optional_headers.magic }}</td>
                                        </tr>
                                        <tr>
                                            <td>MajorImageVersion</td>
                                            <td>{{ payload.optional_headers.majorimageversion }}</td>
                                        </tr>
                                        <tr>
                                            <td>MajorLinkerVersion</td>
                                            <td>{{ payload.optional_headers.majorlinkerversion }}</td>
                                        </tr>
                                        <tr>
                                            <td>MajorOperatingSystemVersion</td>
                                            <td>{{ payload.optional_headers.majoroperatingsystemversion }}</td>
                                        </tr>
                                        <tr>
                                            <td>MajorSubsystemVersion</td>
                                            <td>{{ payload.optional_headers.majorsubsystemversion }}</td>
                                        </tr>
                                        <tr>
                                            <td>MinorImageVersion</td>
                                            <td>{{ payload.optional_headers.minorimageversion }}</td>
                                        </tr>
                                        <tr>
                                            <td>MinorLinkerVersion</td>
                                            <td>{{ payload.optional_headers.minorlinkerversion }}</td>
                                        </tr>
                                        <tr>
                                            <td>MinorOperatingSystemVersion</td>
                                            <td>{{ payload.optional_headers.minoroperatingsystemversion }}</td>
                                        </tr>
                                        <tr>
                                            <td>MinorSubsystemVersion</td>
                                            <td>{{ payload.optional_headers.minorsubsystemversion }}</td>
                                        </tr>
                                        <tr>
                                            <td>NumberOfRvaAndSizes</td>
                                            <td>{{ payload.optional_headers.numberofrvaandsizes }}</td>
                                        </tr>
                                        <tr>
                                            <td>Reserved1</td>
                                            <td>{{ payload.optional_headers.reserved1 }}</td>
                                        </tr>
                                        <tr>
                                            <td>SectionAlignment</td>
                                            <td>{{ payload.optional_headers.sectionalignment }}</td>
                                        </tr>
                                        <tr>
                                            <td>SizeOfCode</td>
                                            <td>{{ payload.optional_headers.sizeofcode }}</td>
                                        </tr>
                                        <tr>
                                            <td>SizeOfHeaders</td>
                                            <td>{{ payload.optional_headers.sizeofheaders }}</td>
                                        </tr>
                                        <tr>
                                            <td>SizeOfHeapCommit</td>
                                            <td>{{ payload.optional_headers.sizeofheapcommit }}</td>
                                        </tr>
                                        <tr>
                                            <td>SizeOfHeapReserve</td>
                                            <td>{{ payload.optional_headers.sizeofheapreserve }}</td>
                                        </tr>
                                        <tr>
                                            <td>SizeOfImage</td>
                                            <td>{{ payload.optional_headers.sizeofimage }}</td>
                                        </tr>
                                        <tr>
                                            <td>SizeOfInitializedData</td>
                                            <td>{{ payload.optional_headers.sizeofinitializeddata }}</td>
                                        </tr>
                                        <tr>
                                            <td>SizeOfStackCommit</td>
                                            <td>{{ payload.optional_headers.sizeofstackcommit }}</td>
                                        </tr>
                                        <tr>
                                            <td>SizeOfStackReserve</td>
                                            <td>{{ payload.optional_headers.sizeofstackreserve }}</td>
                                        </tr>
                                        <tr>
                                            <td>SizeOfUninitializedData</td>
                                            <td>{{ payload.optional_headers.sizeofuninitializeddata }}</td>
                                        </tr>
                                        <tr>
                                            <td>Subsystem</td>
                                            <td>{{ payload.optional_headers.subsystem }}</td>
                                        </tr>
                                        <tr>
                                            <td>Name</td>
                                            <td>{{ payload.optional_headers.name }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="tab-pane fade" id="peimports" role="tabpanel">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Ordinal</th>
                                            <th>Bind</th>
                                            <th>Type</th>
                                            <th>Name</th>
                                            <th>Library Name</th>
                                            <th>PLT</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for export in payload.imports %}
                                        <tr>
                                            <td>{{ export.ordinal }}</td>
                                            <td>{{ export.bind }}</td>
                                            <td>{{ export.type }}</td>
                                            <td>{{ export.name }}</td>
                                            <td>{{ export.libname }}</td>
                                            <td>{{ export.plt }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <div class="tab-pane fade" id="peexports" role="tabpanel">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Ordinal</th>
                                            <th>Bind</th>
                                            <th>Type</th>
                                            <th>Name</th>
                                            <th>Library Name</th>
                                            <th>PLT</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for export in payload.exports %}
                                        <tr>
                                            <td>{{ export.ordinal }}</td>
                                            <td>{{ export.bind }}</td>
                                            <td>{{ export.type }}</td>
                                            <td>{{ export.name }}</td>
                                            <td>{{ export.libname }}</td>
                                            <td>{{ export.plt }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <div class="tab-pane fade" id="sections" role="tabpanel">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Size</th>
                                            <th>Virtual Size</th>
                                            <th>Permissions</th>
                                            <th>Flags</th>
                                            <th>Physical Address</th>
                                            <th>Virtual Address</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for section in payload.sections %}
                                        <tr>
                                            <td>{{ section.name }}</td>
                                            <td>{{ section.size }}</td>
                                            <td>{{ section.vsize }}</td>
                                            <td>{{ section.perm }}</td>
                                            <td>{{ section.flags }}</td>
                                            <td>{{ section.paddr }}</td>
                                            <td>{{ section.vaddr }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <div class="tab-pane fade" id="compilers" role="tabpanel">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Version</th>
                                            <th>Type</th>
                                            <th>Info</th>
                                            <th>String</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for compiler in payload.compilers %}
                                        <tr>
                                            <td>{{ compiler.name }}</td>
                                            <td>{{ compiler.version }}</td>
                                            <td>{{ compiler.type }}</td>
                                            <td>{{ compiler.info }}</td>
                                            <td>{{ compiler.string }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <div class="tab-pane fade" id="libraries" role="tabpanel">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Version</th>
                                            <th>Type</th>
                                            <th>Info</th>
                                            <th>String</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for library in payload.libraries %}
                                        <tr>
                                            <td>{{ library.name }}</td>
                                            <td>{{ library.version }}</td>
                                            <td>{{ library.type }}</td>
                                            <td>{{ library.info }}</td>
                                            <td>{{ library.string }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <div class="tab-pane fade" id="linkers" role="tabpanel">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Version</th>
                                            <th>Type</th>
                                            <th>Info</th>
                                            <th>String</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for linker in payload.linkers %}
                                        <tr>
                                            <td>{{ linker.name }}</td>
                                            <td>{{ linker.version }}</td>
                                            <td>{{ linker.type }}</td>
                                            <td>{{ linker.info }}</td>
                                            <td>{{ linker.string }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <div class="tab-pane fade" id="packers" role="tabpanel">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Version</th>
                                            <th>Type</th>
                                            <th>Info</th>
                                            <th>String</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for packer in payload.packers %}
                                        <tr>
                                            <td>{{ packer.name }}</td>
                                            <td>{{ packer.version }}</td>
                                            <td>{{ packer.type }}</td>
                                            <td>{{ packer.info }}</td>
                                            <td>{{ packer.string }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <div class="tab-pane fade" id="sign_tools" role="tabpanel">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Version</th>
                                            <th>Type</th>
                                            <th>Info</th>
                                            <th>String</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for sign_tool in payload.sign_tools %}
                                        <tr>
                                            <td>{{ sign_tool.name }}</td>
                                            <td>{{ sign_tool.version }}</td>
                                            <td>{{ sign_tool.type }}</td>
                                            <td>{{ sign_tool.info }}</td>
                                            <td>{{ sign_tool.string }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <div class="tab-pane fade" id="tools" role="tabpanel">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Version</th>
                                            <th>Type</th>
                                            <th>Info</th>
                                            <th>String</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for tool in payload.tools %}
                                        <tr>
                                            <td>{{ tool.name }}</td>
                                            <td>{{ tool.version }}</td>
                                            <td>{{ tool.type }}</td>
                                            <td>{{ tool.info }}</td>
                                            <td>{{ tool.string }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        {% endif %}

        {% if task.function_mappings %}

        <!-- Function Mapping -->
        <div class="row mb-4">
            <div class="col-lg-12 mb-4">
                <div class="card h-100">
                    <div class="card-body p-3">
                        <h5 class="card-title">Function Mapping</h5>
                        <table class="table" id="functionTable">
                            <thead>
                                <tr>
                                    <th>DLL</th>
                                    <th>Function</th>
                                    <th>Category</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for mapping in task.function_mappings %}
                                <tr>
                                    <td>{{ mapping.dll }}</td>
                                    <td>{{ mapping.function }}</td>
                                    <td>{{ mapping.category }}</td>
                                    <td>{{ mapping.description }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        {% if task.capa_reports %}
        <!-- MITRE ATT&CK -->
        <div class="row mb-4">
            <div class="col-lg-12 mb-4">
                <div class="card h-100">
                    <div class="card-body p-3">
                        <h5 class="card-title">CAPA Analysis</h5>
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" data-bs-toggle="tab" href="#mitre" role="tab">MITRE
                                    ATT&CK</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-bs-toggle="tab" href="#mbc" role="tab">Malware
                                    Behaviour</a>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="mitre" role="tabpanel">
                                <table class="table" id="mitreTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Tactic</th>
                                            <th>Technique</th>
                                            <th>Subtechnique</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for report in task.capa_reports %}
                                        {% if report.mitre_techniques %}
                                        {% for mt in report.mitre_techniques %}
                                        <tr>
                                            {% if mt.tid %}
                                            <td><a href="https://attack.mitre.org/techniques/{{mt.tid}}/">{{mt.tid}}</a>
                                            </td>
                                            {% else %}
                                            <td></td>
                                            {% endif %}
                                            <td>{{ report.name }}</td>
                                            <td>{{ mt.tactic }}</td>
                                            <td>{{ mt.technique }}</td>
                                            <td>{{ mt.subtechnique if mt.subtechnique else "" }}</td>
                                        </tr>
                                        {% endfor %}
                                        {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <div class="tab-pane fade" id="mbc" role="tabpanel">
                                <table class="table" id="mbcTable">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Objective</th>
                                            <th>Behavior</th>
                                            <th>Method</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for report in task.capa_reports %}
                                        {% if report.malware_behaviour_catalogs %}
                                        {% for mbc in report.malware_behaviour_catalogs %}
                                        <tr>
                                            <td>{{ report.name }}</td>
                                            <td>{{ mbc.objective }}</td>
                                            <td>{{ mbc.behavior }}</td>
                                            <td>{{ mbc.method }}</td>
                                        </tr>
                                        {% endfor %}
                                        {% endif %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        {% if task.similar_tlsh_hashes %}
        <!-- TLSH Hashes -->
        <div class="row mb-4">
            <div class="col-lg-12 mb-4">
                <div class="card h-100">
                    <div class="card-body p-3">
                        <h5 class="card-title">Similar TLSH Hashes</h5>

                        <table class="table" id="tlshTable">
                            <thead>
                                <tr>
                                    <th>TLSH</th>
                                    <th>SHA256</th>
                                    <th>Distance</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for hash_entry in task.similar_tlsh_hashes %}
                                <tr style="background-color: 
                        {% if hash_entry.distance == 0 %}#ffcccc
                        {% elif hash_entry.distance <= 20 %}#ffffcc
                        {% elif hash_entry.distance <= 30 %}#ffe5cc
                        {% else %}#ffffff
                        {% endif %};">
                                    <td class="text-truncate" style="max-width: 300px; font-size: smaller;"
                                        title="{{ hash_entry.tlsh }}">
                                        <a href="https://www.virustotal.com/gui/search/tlsh%253A{{hash_entry.tlsh}}">{{
                                            hash_entry.tlsh }}</a>
                                    </td>
                                    <td class="text-truncate" style="max-width: 300px; font-size: smaller;"
                                        title="{{ hash_entry.sha256 }}">
                                        <a href="https://www.virustotal.com/gui/file/{{ hash_entry.sha256 }}">{{
                                            hash_entry.sha256 }}</a>
                                    </td>
                                    <td>{{ hash_entry.distance }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}


        {% if task.x_y_malicious_bytes.ascii_byte_representation or
        task.zero_x_malicious_bytes.ascii_byte_representation %}
        <div class="row mb-4">
            {% if task.x_y_malicious_bytes.ascii_byte_representation %}
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body p-3">
                        <h5 class="card-title">X - Y Malicious Bytes</h5>
                        <p class="text-muted mb-0">
                            This function calculates the detection point based on the given coordinates. The
                            detection
                            point is determined by subtracting the increment scan size from the X and Y
                            coordinates.
                        </p>
                        <div style="max-height: 300px; overflow-y: auto;">
                            <pre><code class="byte-code">{{ task.x_y_malicious_bytes.ascii_byte_representation }}</code></pre>
                        </div>
                        {% else %}
                        <p class="text-muted mb-0">No malicious bytes found.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            {% if task.zero_x_malicious_bytes.ascii_byte_representation %}
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body p-3">
                        <h5 class="card-title">0 - X Malicious Bytes</h5>
                        <p class="text-muted mb-0">
                            This function calculates the detection point from the start of the file to the given
                            X
                            coordinate. The detection point is determined by analyzing the bytes from the
                            beginning
                            of
                            the file up to the X coordinate.
                        </p>
                        {% if task.zero_x_malicious_bytes %}
                        <div style="max-height: 300px; overflow-y: auto;">
                            <pre><code class="byte-code">{{ task.zero_x_malicious_bytes.ascii_byte_representation }}</code></pre>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        {% if task.thorough_malicious_bytes %}
        <!-- Thorough Malicious Bytes -->
        <div class="row mb-4">
            <div class="col-lg-12 mb-4">
                <div class="card h-100">
                    <div class="card-body p-3">
                        <h5 class="card-title">Thorough Malicious Bytes Analysis</h5>
                        <p class="text-muted mb-0">
                            This function scans the entire file and tracks when an increment is detected and
                            when it
                            isn't, then pairs them up to identify all malicious segments.
                        </p>
                        <ul class="nav nav-tabs" id="thoroughMaliciousBytesTab" role="tablist">
                            {% for segment in task.thorough_malicious_bytes %}
                            <li class="nav-item" role="presentation">
                                <a class="nav-link {% if loop.first %}active{% endif %}"
                                    id="segment-{{ loop.index }}-tab" data-bs-toggle="tab"
                                    href="#segment-{{ loop.index }}" role="tab" aria-controls="segment-{{ loop.index }}"
                                    aria-selected="{% if loop.first %}true{% else %}false{% endif %}">
                                    Segment {{ loop.index }}
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                        <div class="tab-content mt-3" id="thoroughMaliciousBytesTabContent">
                            {% for segment in task.thorough_malicious_bytes %}
                            <div class="tab-pane fade {% if loop.first %}show active{% endif %}"
                                id="segment-{{ loop.index }}" role="tabpanel"
                                aria-labelledby="segment-{{ loop.index }}-tab">
                                <div style="max-height: 300px; overflow-y: auto;">
                                    <pre><code class="byte-code">{{ segment.ascii_byte_representation }}</code></pre>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function () {
            $('.table').DataTable({
                pageLength: 10,
                lengthChange: true,
                searching: true,
                ordering: true,
                info: false,
                responsive: true,
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Search..."
                },
                dom: '<"d-flex justify-content-between align-items-center"<"col-md-6"l><"col-md-6"f>>rt<"d-flex justify-content-between align-items-center"<"col-md-6"i><"col-md-6"p>>',
                drawCallback: function () {
                    $('.dataTables_paginate > .pagination').addClass('pagination-sm');
                }
            });
        });
    </script>
</body>

</html>